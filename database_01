#Criação do Container:
docker run -itd  -e MYSQL_ROOT_PASSWORD=hesoyam --name database_01 --net rede-voip --ip 192.168.1.200 --cap-add NET_ADMIN mysql

#Configuração Database:
docker exec -it database_01 /bin/bash


bash-4.4# mysql -u root -p 

	create database apolo;

	create database hermes;

	create database poseidon;
	
	create database hades;

    use apolo;



Inserir ramal teste:

insert into sipfriends (id, name, type, host, secret, nat, context, qualify) values
 ('1','1001','friend','dynamic','123456','force_rport,comedia', 'teste', 'yes');


Criar tabela de rotas:

CREATE TABLE `routes` (
`id` int(11) NOT NULL auto_increment,
`context` varchar(20) NOT NULL default '',
`exten` varchar(20) NOT NULL default '',
`priority` tinyint(4) NOT NULL default '0',
`app` varchar(20) NOT NULL default '',
`appdata` varchar(128) NOT NULL default '',
PRIMARY KEY (`context`,`exten`,`priority`),
KEY `id` (`id`)
);

#### formato dos dados na tabela de rotas: #####
#### se a call não estiver passando audio ou não reproduzindo musica de espera, tem que usar o answer() #####
'1', 'anycall', '_7000', '1', 'Answer', 'Answer()'
'1', 'anycall', '_7000', '2', 'MixMonitor', '/gravacoes/${UNIQUEID}.wav'
'1', 'anycall', '_7000', '3', 'Queue', '7000'
'4', 'anycall', '_8000', '1', 'Answer', 'Answer()'
'2', 'anycall', '_8000', '2', 'Queue', '8000'
'3', 'anycall', '_X.', '1', 'Dial', 'SIP/${EXTEN}'


Criar tabela de cdr:

 CREATE TABLE `cdr` (
 `calldate` datetime NOT NULL ,
 `clid` varchar(80) NOT NULL default '',
 `src` varchar(80) NOT NULL default '',
 `dst` varchar(80) NOT NULL default '',
 `dcontext` varchar(80) NOT NULL default '', 
 `channel` varchar(80) NOT NULL default '',
 `dstchannel` varchar(80) NOT NULL default '',
 `lastapp` varchar(80) NOT NULL default '',
 `lastdata` varchar(80) NOT NULL default '',
 `duration` int(11) NOT NULL default '0',
 `billsec` int(11) NOT NULL default '0',
 `disposition` varchar(45) NOT NULL default '', 
 `amaflags` int(11) NOT NULL default '0',
 `accountcode` varchar(20) NOT NULL default '',
 `userfield` varchar(255) NOT NULL default '',
 `uniqueid` VARCHAR(32) NOT NULL default '',
 `linkedid` VARCHAR(32) NOT NULL default '',
 `sequence` VARCHAR(32) NOT NULL default '',
 `peeraccount` VARCHAR(32) NOT NULL default ''
 );

 ALTER TABLE `cdr` ADD INDEX ( `calldate` );
 ALTER TABLE `cdr` ADD INDEX ( `dst` );
 ALTER TABLE `cdr` ADD INDEX ( `accountcode` );



Criar tabela de queues:


CREATE TABLE queues (
name VARCHAR(128) PRIMARY KEY,
musiconhold VARCHAR(128),
announce VARCHAR(128),
context VARCHAR(128),
timeout INT(11),
monitor_join BOOL,
monitor_format VARCHAR(128),
queue_youarenext VARCHAR(128),
queue_thereare VARCHAR(128),
queue_callswaiting VARCHAR(128),
queue_holdtime VARCHAR(128),
queue_minutes VARCHAR(128),
queue_seconds VARCHAR(128),
queue_lessthan VARCHAR(128),
queue_thankyou VARCHAR(128),
queue_reporthold VARCHAR(128),
announce_frequency INT(11),
announce_round_seconds INT(11),
announce_holdtime VARCHAR(128),
retry INT(11),
wrapuptime INT(11),
maxlen INT(11),
servicelevel INT(11),
strategy VARCHAR(128),
joinempty VARCHAR(128),
leavewhenempty VARCHAR(128),
eventmemberstatus BOOL,
eventwhencalled BOOL,
reportholdtime BOOL,
memberdelay INT(11),
weight INT(11),
timeoutrestart BOOL,
periodic_announce VARCHAR(50),
periodic_announce_frequency INT(11),
ringinuse BOOL,
setintTCCterfacevar BOOL
);



CREATE TABLE queue_members (
uniqueid INT(10) UNSIGNED PRIMARY KEY AUTO_INCREMENT,
membername varchar(40),
queue_name varchar(128),
interface varchar(128),
penalty INT(11),
paused INT(11),
UNIQUE KEY queue_interface (queue_name, interface)
);


### COLOCAR UMA FK DE queue_members.queue_name para queues.name ####
### ADICIONEI A FK VIA MYSQL WORKBENCH, NO ENTANTO PODE SER FEITO VIA CODIGO ASSIM: ###

ALTER TABLE queue_members
ADD CONSTRAINT fk_queue_name
FOREIGN KEY (queue_name) 
REFERENCES queues(name);

